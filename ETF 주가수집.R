#### 라이브러리 ####
library(rvest)
library(dplyr)
library(httr)
library(readr)
library(tidyverse)
library(dplyr)

#### 크롤링 대상 ETF 리스트 ####
tmp1 <- "KR7152100004>ARIRANG 200<KR7295820005>ARIRANG 200동일가중<KR7295890008>ARIRANG 200로우볼<KR7295860001>ARIRANG 200모멘텀<KR7295840003>ARIRANG 200밸류<KR7253150007>ARIRANG 200선물레버리지<KR7253160006>ARIRANG 200선물인버스2X<KR7295880009>ARIRANG 200퀄리티<KR7278420005>ARIRANG ESG우수기업<KR7292750007>ARIRANG KRX300<KR7309170009>ARIRANG KRX300IT<KR7309180008>ARIRANG KRX300금융<KR7309190007>ARIRANG KRX300산업재<KR7309200004>ARIRANG KRX300자유소비재<KR7309210003>ARIRANG KRX300헬스케어<KR7333940005>ARIRANG KS로우볼가중TR<KR7333950004>ARIRANG KS로우사이즈가중TR<KR7333960003>ARIRANG KS모멘텀가중TR<KR7333970002>ARIRANG KS밸류가중TR<KR7333980001>ARIRANG KS퀄리티가중TR<KR7269530002>ARIRANG S&P글로벌인프라<KR7251590006>ARIRANG 고배당저변동50<KR7161510003>ARIRANG 고배당주<KR7251600003>ARIRANG 고배당주채권혼합<KR7289670002>ARIRANG 국채선물10년<KR7298340001>ARIRANG 국채선물3년<KR7189400005>ARIRANG 글로벌MSCI(합성 H)<KR7263190001>ARIRANG 단기우량채권<KR7190160002>ARIRANG 단기유동성<KR7278620000>ARIRANG 단기채권액티브<KR7269540001>ARIRANG 미국S&P500(H)<KR7287180004>ARIRANG 미국나스닥기술주<KR7213630007>ARIRANG 미국다우존스고배당주(합성 H)<KR7332610005>ARIRANG 미국단기우량회사채<KR7332620004>ARIRANG 미국장기우량회사채<KR7195970009>ARIRANG 선진국MSCI(합성 H)<KR7236460002>ARIRANG 스마트베타 LowVOL<KR7222190001>ARIRANG 스마트베타 Momentum<KR7222200008>ARIRANG 스마트베타 Quality<KR7222180002>ARIRANG 스마트베타 Value<KR7238670004>ARIRANG 스마트베타Quality채권혼합<KR7195980008>ARIRANG 신흥국MSCI(합성 H)<KR7256450008>ARIRANG 심천차이넥스트(합성)<KR7239660004>ARIRANG 우량회사채50 1년<KR7280920000>ARIRANG 주도업종<KR7266550003>ARIRANG 중형주저변동50<KR7301400008>ARIRANG 코스닥150<KR7301410007>ARIRANG 코스닥150선물인버스<KR7227830007>ARIRANG 코스피<KR7122090004>ARIRANG 코스피50<KR7328370002>ARIRANG 코스피TR<KR7301440004>ARIRANG 코스피중형주<KR7285690004>FOCUS ESG리더스<KR7292730009>FOCUS KRX300<KR7293180006>HANARO 200<KR7332930007>HANARO 200TR<KR7304780000>HANARO 200선물레버리지<KR7306520008>HANARO 200선물인버스<KR7304760002>HANARO KRX300<KR7332940006>HANARO MSCI Korea TR<KR7322400003>HANARO e커머스<KR7322410002>HANARO 고배당<KR7314700006>HANARO 농업융복합산업<KR7306540006>HANARO 단기통안채<KR7304770001>HANARO 코스닥150<KR7306530007>HANARO 코스닥150선물레버리지<KR7148020001>KBSTAR 200<KR7285000006>KBSTAR 200IT<KR7287300008>KBSTAR 200건설<KR7287310007>KBSTAR 200경기소비재<KR7290080001>KBSTAR 200고배당커버드콜ATM<KR7284980000>KBSTAR 200금융<KR7287320006>KBSTAR 200산업재<KR7287330005>KBSTAR 200생활소비재<KR7252400007>KBSTAR 200선물레버리지<KR7252410006>KBSTAR 200선물인버스<KR7252420005>KBSTAR 200선물인버스2X<KR7284990009>KBSTAR 200에너지화학<KR7285010005>KBSTAR 200중공업<KR7285020004>KBSTAR 200철강소재<KR7315480004>KBSTAR 200커뮤니케이션서비스<KR7105780001>KBSTAR 5대그룹주<KR7290130004>KBSTAR ESG사회책임투자<KR7326240009>KBSTAR IT플러스<KR7270800006>KBSTAR KQ고배당<KR7300300001>KBSTAR KQ모멘텀로우볼<KR7300310000>KBSTAR KQ모멘텀밸류<KR7292050002>KBSTAR KRX300<KR7307010009>KBSTAR KRX300레버리지<KR7319870002>KBSTAR KRX300미국달러선물혼합<KR7307020008>KBSTAR KRX300선물인버스<KR7234310001>KBSTAR V&S셀렉트밸류<KR7241390004>KBSTAR V&S셀렉트밸류채권혼합<KR7300640000>KBSTAR 게임테마<KR7266160001>KBSTAR 고배당<KR7114100001>KBSTAR 국고채3년<KR7282000009>KBSTAR 국고채3년선물인버스<KR7295000004>KBSTAR 국채선물10년<KR7295020002>KBSTAR 국채선물10년인버스<KR7276650009>KBSTAR 글로벌4차산업IT(합성 H)<KR7336160007>KBSTAR 금융채액티브<KR7326230000>KBSTAR 내수주플러스<KR7272560004>KBSTAR 단기국공채액티브<KR7196230007>KBSTAR 단기통안채<KR7315960005>KBSTAR 대형고배당10TR<KR7252730007>KBSTAR 모멘텀로우볼<KR7252720008>KBSTAR 모멘텀밸류<KR7219390002>KBSTAR 미국S&P원유생산기업(합성 H)<KR7267440006>KBSTAR 미국장기국채선물(H)<KR7267490001>KBSTAR 미국장기국채선물레버리지(합성 H)<KR7267450005>KBSTAR 미국장기국채선물인버스(H)<KR7267500007>KBSTAR 미국장기국채선물인버스2X(합성 H)<KR7140570003>KBSTAR 수출주<KR7140580002>KBSTAR 우량업종<KR7196220008>KBSTAR 일본TOPIX레버리지(H)<KR7183710003>KBSTAR 주식혼합<KR7310080007>KBSTAR 중국MSCI China선물(H)"
tmp2 <- "KR7174360008>KBSTAR 중국본토대형주CSI100<KR7136340007>KBSTAR 중기우량회사채<KR7281990002>KBSTAR 중소형고배당<KR7300280005>KBSTAR 중소형모멘텀로우볼<KR7300290004>KBSTAR 중소형모멘텀밸류<KR7272570003>KBSTAR 중장기국공채액티브<KR7283930006>KBSTAR 지주회사<KR7250730009>KBSTAR 차이나HSCEI(H)<KR7291680007>KBSTAR 차이나H선물인버스(H)<KR7183700004>KBSTAR 채권혼합<KR7270810005>KBSTAR 코스닥150<KR7278240007>KBSTAR 코스닥150선물레버리지<KR7275750008>KBSTAR 코스닥150선물인버스<KR7302450002>KBSTAR 코스피<KR7334690005>KBSTAR 팔라듐선물(H)<KR7334700002>KBSTAR 팔라듐선물인버스(H)<KR7253280002>KBSTAR 헬스케어<KR7253290001>KBSTAR 헬스케어채권혼합<KR7105190003>KINDEX 200<KR7332500008>KINDEX 200TR<KR7277540001>KINDEX S&P아시아TOP50<KR7225130004>KINDEX 골드선물 레버리지(합성 H)<KR7299070003>KINDEX 국채선물10년인버스<KR7299080002>KINDEX 국채선물3년인버스<KR7190620005>KINDEX 단기통안채<KR7265690008>KINDEX 러시아MSCI(합성)<KR7152500005>KINDEX 레버리지<KR7291130003>KINDEX 멕시코MSCI(합성)<KR7280320003>KINDEX 미국4차산업인터넷(합성 H)<KR7309230001>KINDEX 미국WideMoat가치주<KR7181480005>KINDEX 미국다우존스리츠(합성 H)<KR7211260005>KINDEX 배당성장<KR7143460004>KINDEX 밸류대형<KR7245710009>KINDEX 베트남VN30(합성)<KR7131890006>KINDEX 삼성그룹동일가중<KR7108450008>KINDEX 삼성그룹섹터가중<KR7322130006>KINDEX 스마트로우볼<KR7272220005>KINDEX 스마트모멘텀<KR7272230004>KINDEX 스마트밸류<KR7322120007>KINDEX 스마트퀄리티<KR7322150004>KINDEX 스마트하이베타<KR7316300003>KINDEX 싱가포르리츠<KR7256440009>KINDEX 인도네시아MSCI(합성)<KR7145670006>KINDEX 인버스<KR7238720007>KINDEX 일본Nikkei225(H)<KR7196030001>KINDEX 일본TOPIX레버리지(H)<KR7205720006>KINDEX 일본TOPIX인버스(합성 H)<KR7168580009>KINDEX 중국본토CSI300<KR7219900008>KINDEX 중국본토CSI300레버리지(합성)<KR7114460009>KINDEX 중기국고채<KR7272910001>KINDEX 중장기국공채액티브<KR7251890000>KINDEX 코스닥(합성)<KR7305050007>KINDEX 코스피<KR7261920003>KINDEX 필리핀MSCI(합성)<KR7226380004>KINDEX 한류<KR7069500007>KODEX 200<KR7226980001>KODEX 200 중소형<KR7278530001>KODEX 200TR<KR7223190000>KODEX 200가치저변동<KR7252650007>KODEX 200동일가중<KR7284430006>KODEX 200미국채혼합<KR7252670005>KODEX 200선물인버스2X<KR7305720005>KODEX 2차전지산업<KR7271060006>KODEX 3대농산물선물(H)<KR7099140006>KODEX China H<KR7204450001>KODEX China H 레버리지(H)<KR7291660009>KODEX China H선물인버스(H)<KR7296710007>KODEX FnKorea50<KR7325010007>KODEX Fn성장<KR7266370006>KODEX IT<KR7292190006>KODEX KRX300<KR7306950007>KODEX KRX300레버리지<KR7306960006>KODEX KRX300선물인버스<KR7229720008>KODEX KTOP30<KR7291890002>KODEX MSCI EM선물(H)<KR7289040008>KODEX MSCI KOREA ESG유니버설<KR7156080004>KODEX MSCI Korea<KR7278540000>KODEX MSCI Korea TR<KR7275280006>KODEX MSCI모멘텀<KR7275290005>KODEX MSCI밸류<KR7275300002>KODEX MSCI퀄리티<KR7269420006>KODEX S&P글로벌인프라(합성)<KR7329650006>KODEX TRF3070<KR7329660005>KODEX TRF5050<KR7329670004>KODEX TRF7030<KR7315930008>KODEX Top5PlusTR<KR7261220008>KODEX WTI원유선물(H)<KR7271050007>KODEX WTI원유선물인버스(H)<KR7247780000>KODEX 가치투자<KR7117700005>KODEX 건설<KR7300950003>KODEX 게임산업<KR7266390004>KODEX 경기소비재<KR7279530000>KODEX 고배당<KR7132030008>KODEX 골드선물(H)<KR7280940008>KODEX 골드선물인버스(H)<KR7138910005>KODEX 구리선물(H)<KR7114260003>KODEX 국고채3년<KR7152380002>KODEX 국채선물10년<KR7176950004>KODEX 국채선물10년인버스<KR7292770005>KODEX 국채선물3년인버스<KR7276990009>KODEX 글로벌4차산업로보틱스(합성)<KR7102960002>KODEX 기계장비<KR7273140004>KODEX 단기변동금리부채권액티브<KR7153130000>KODEX 단기채권<KR7214980005>KODEX 단기채권PLUS<KR7122630007>KODEX 레버리지<KR7321410003>KODEX 멀티에셋하이인컴(H)<KR7244620001>KODEX 모멘텀Plus<KR7314250002>KODEX 미국FANG플러스(H)<KR7219480001>KODEX 미국S&P500선물(H)<KR7276970001>KODEX 미국S&P고배당커버드콜(합성 H)<KR7185680006>KODEX 미국S&P바이오(합성)<KR7200030005>KODEX 미국S&P산업재(합성)<KR7218420008>KODEX 미국S&P에너지(합성)<KR7304940000>KODEX 미국나스닥100선물(H)<KR7261240006>KODEX 미국달러선물<KR7261250005>KODEX 미국달러선물레버리지<KR7261270003>KODEX 미국달러선물인버스<KR7261260004>KODEX 미국달러선물인버스2X"
tmp3 <- "KR7280930009>KODEX 미국러셀2000(H)<KR7308620004>KODEX 미국채10년선물<KR7304660004>KODEX 미국채울트라30년선물(H)<KR7304670003>KODEX 미국채울트라30년선물인버스(H)<KR7266360007>KODEX 미디어&엔터테인먼트<KR7244580007>KODEX 바이오<KR7091160002>KODEX 반도체<KR7325020006>KODEX 배당가치<KR7211900006>KODEX 배당성장<KR7237370002>KODEX 배당성장채권혼합<KR7244670006>KODEX 밸류Plus<KR7140700006>KODEX 보험<KR7102780004>KODEX 삼성그룹<KR7213610009>KODEX 삼성그룹밸류<KR7251350005>KODEX 선진국MSCI World<KR7247790009>KODEX 성장투자<KR7256750001>KODEX 심천ChiNext(합성)<KR7117460006>KODEX 에너지화학<KR7140710005>KODEX 운송<KR7144600004>KODEX 은선물(H)<KR7091170001>KODEX 은행<KR7114800006>KODEX 인버스<KR7101280006>KODEX 일본TOPIX100<KR7091180000>KODEX 자동차<KR7273130005>KODEX 종합채권(AA-이상)액티브<KR7169950003>KODEX 중국본토 A50<KR7283580009>KODEX 중국본토CSI300<KR7102970001>KODEX 증권<KR7117680009>KODEX 철강<KR7279540009>KODEX 최소변동성<KR7229200001>KODEX 코스닥 150<KR7233740000>KODEX 코스닥150 레버리지<KR7251340006>KODEX 코스닥150선물인버스<KR7226490001>KODEX 코스피<KR7237350004>KODEX 코스피100<KR7138920004>KODEX 콩선물(H)<KR7244660007>KODEX 퀄리티Plus<KR7247800006>KODEX 턴어라운드투자<KR7266410000>KODEX 필수소비재<KR7298770009>KODEX 한국대만IT프리미어<KR7266420009>KODEX 헬스케어<KR7069660009>KOSEF 200<KR7152280004>KOSEF 200 선물<KR7294400007>KOSEF 200TR<KR7253250005>KOSEF 200선물레버리지<KR7253240006>KOSEF 200선물인버스<KR7253230007>KOSEF 200선물인버스2X<KR7331910000>KOSEF Fn중소형<KR7100910009>KOSEF KRX100<KR7104530001>KOSEF 고배당<KR7148070006>KOSEF 국고채10년<KR7167860006>KOSEF 국고채10년레버리지<KR7114470008>KOSEF 국고채3년<KR7130730005>KOSEF 단기자금<KR7138230008>KOSEF 미국달러선물<KR7230480006>KOSEF 미국달러선물 인버스2X(합성)<KR7225800002>KOSEF 미국달러선물레버리지<KR7139660005>KOSEF 미국달러선물인버스<KR7260200001>KOSEF 배당바이백Plus<KR7104520002>KOSEF 블루칩<KR7200250009>KOSEF 인도Nifty50(합성)<KR7260270004>KOSEF 저PBR가중<KR7316670009>KOSEF 코스닥150<KR7291610004>KOSEF 코스닥150선물<KR7291630002>KOSEF 코스닥150선물레버리지<KR7291620003>KOSEF 코스닥150선물인버스<KR7153270004>KOSEF 코스피100<KR7122260003>KOSEF 통안채1년<KR7168300002>KTOP 코스피50<KR7295040000>SMART 200TR<KR7292500006>SMART KRX300<KR7208470005>SMART 선진국MSCI World(합성 H)<KR7220130009>SMART 중국본토 중소형 CSI500(합성 H)<KR7102110004>TIGER 200<KR7139260004>TIGER 200 IT<KR7139220008>TIGER 200 건설<KR7139290001>TIGER 200 경기소비재<KR7139270003>TIGER 200 금융<KR7227550001>TIGER 200 산업재<KR7227560000>TIGER 200 생활소비재<KR7139250005>TIGER 200 에너지화학<KR7139230007>TIGER 200 중공업<KR7139240006>TIGER 200 철강소재<KR7227540002>TIGER 200 헬스케어<KR7243880002>TIGER 200IT레버리지<KR7310960000>TIGER 200TR<KR7252000005>TIGER 200동일가중<KR7267770006>TIGER 200선물레버리지<KR7252710009>TIGER 200선물인버스2X<KR7243890001>TIGER 200에너지화학레버리지<KR7315270009>TIGER 200커뮤니케이션서비스<KR7166400002>TIGER 200커버드콜5%OTM<KR7289480006>TIGER 200커버드콜ATM<KR7305540007>TIGER 2차전지테마<KR7292160009>TIGER KRX300<KR7307610006>TIGER KRX300레버리지<KR7307620005>TIGER KRX300선물인버스<KR7228820007>TIGER KTOP30<KR7300610003>TIGER K게임<KR7138530001>TIGER LG그룹+펀더멘털<KR7289260002>TIGER MSCI KOREA ESG리더스<KR7289250003>TIGER MSCI KOREA ESG유니버설<KR7310970009>TIGER MSCI Korea TR<KR7269370003>TIGER S&P글로벌인프라(합성)<KR7248270001>TIGER S&P글로벌헬스케어(합성)<KR7292150000>TIGER TOP10<KR7217790005>TIGER 가격조정<KR7139280002>TIGER 경기방어<KR7237440003>TIGER 경기방어채권혼합<KR7319640009>TIGER 골드선물(H)<KR7160580007>TIGER 구리실물<KR7114820004>TIGER 국채3년<KR7302180005>TIGER 국채선물10년인버스<KR7302170006>TIGER 국채선물3년인버스<KR7275980001>TIGER 글로벌4차산업혁신기술(합성 H)<KR7276000007>TIGER 글로벌자원생산기업(합성 H)<KR7139310007>TIGER 금속선물(H)<KR7139320006>TIGER 금은선물(H)<KR7137610002>TIGER 농산물선물Enhanced(H)<KR7182490003>TIGER 단기선진하이일드(합성 H)<KR7272580002>TIGER 단기채권액티브<KR7157450008>TIGER 단기통안채<KR7253990006>TIGER 대만TAIEX선물(H)<KR7292110004>TIGER 대형가치"
tmp4 <- "KR7292100005>TIGER 대형성장<KR7105010003>TIGER 라틴35<KR7123320004>TIGER 레버리지<KR7174350009>TIGER 로우볼<KR7147970008>TIGER 모멘텀<KR7182480004>TIGER 미국MSCI리츠(합성 H)<KR7225040005>TIGER 미국S&P500레버리지(합성 H)<KR7143850006>TIGER 미국S&P500선물(H)<KR7225030006>TIGER 미국S&P500선물인버스(H)<KR7133690008>TIGER 미국나스닥100<KR7203780002>TIGER 미국나스닥바이오<KR7245340005>TIGER 미국다우존스30<KR7329750004>TIGER 미국달러단기채권액티브<KR7261110001>TIGER 미국달러선물레버리지<KR7261120000>TIGER 미국달러선물인버스2X<KR7305080004>TIGER 미국채10년선물<KR7228810008>TIGER 미디어컨텐츠<KR7091230003>TIGER 반도체<KR7098560006>TIGER 방송통신<KR7211560008>TIGER 배당성장<KR7170350003>TIGER 베타플러스<KR7329200000>TIGER 부동산인프라고배당<KR7138520002>TIGER 삼성그룹펀더멘털<KR7157490004>TIGER 소프트웨어<KR7228800009>TIGER 여행레저<KR7227570009>TIGER 우량가치<KR7261140008>TIGER 우선주<KR7130680002>TIGER 원유선물Enhanced(H)<KR7217770007>TIGER 원유선물인버스(H)<KR7195930003>TIGER 유로스탁스50(합성 H)<KR7225050004>TIGER 유로스탁스레버리지(합성 H)<KR7245350004>TIGER 유로스탁스배당30<KR7091220004>TIGER 은행<KR7307510008>TIGER 의료기기<KR7225060003>TIGER 이머징마켓MSCI레버리지(합성 H)<KR7236350005>TIGER 인도니프티50레버리지(합성)<KR7123310005>TIGER 인버스<KR7195920004>TIGER 일본TOPIX(합성 H)<KR7248260002>TIGER 일본TOPIX헬스케어(합성)<KR7241180009>TIGER 일본니케이225<KR7292560000>TIGER 일본엔선물<KR7292570009>TIGER 일본엔선물레버리지<KR7292580008>TIGER 일본엔선물인버스<KR7292590007>TIGER 일본엔선물인버스2X<KR7150460004>TIGER 중국소비테마<KR7292120003>TIGER 중소형<KR7292140001>TIGER 중소형가치<KR7292130002>TIGER 중소형성장<KR7302190004>TIGER 중장기국채<KR7302200001>TIGER 중장기국채선물인버스<KR7302210000>TIGER 중장기국채선물인버스2X<KR7157500000>TIGER 증권<KR7266140003>TIGER 지속배당<KR7307520007>TIGER 지주회사<KR7192090009>TIGER 차이나CSI300<KR7204480008>TIGER 차이나CSI300레버리지(합성)<KR7217780006>TIGER 차이나CSI300인버스(합성)<KR7245360003>TIGER 차이나HSCEI<KR7117690008>TIGER 차이나항셍25<KR7232080002>TIGER 코스닥150<KR7233160001>TIGER 코스닥150 레버리지<KR7261060008>TIGER 코스닥150IT<KR7267300002>TIGER 코스닥150로우볼<KR7261070007>TIGER 코스닥150바이오테크<KR7250780004>TIGER 코스닥150선물인버스<KR7277630000>TIGER 코스피<KR7210780003>TIGER 코스피고배당<KR7277640009>TIGER 코스피대형주<KR7277650008>TIGER 코스피중형주<KR7143860005>TIGER 헬스케어<KR7138540000>TIGER 현대차그룹+펀더멘털<KR7228790002>TIGER 화장품<KR7108590001>TREX 200<KR7097750004>TREX 중소형가치<KR7145850004>TREX 펀더멘탈 200<KR7137930004>마이다스 200커버드콜5%OTM<KR7292340007>마이티 200커버드콜ATM레버리지<KR7159800002>마이티 코스피100<KR7211210000>마이티 코스피고배당<KR7152870002>파워 200<KR7192720001>파워 고배당저변동성<KR7275540003>파워 스마트밸류<KR7176710002>파워 중기국고채<KR7140950007>파워 코스피100<KR7215620006>흥국 S&P코리아로우볼"

str_split(tmp1, ">|<") %>% unlist -> etf1
str_split(tmp2, ">|<") %>% unlist -> etf2
str_split(tmp3, ">|<") %>% unlist -> etf3
str_split(tmp4, ">|<") %>% unlist -> etf4

etf <- c(etf1, etf2, etf3, etf4)
rm(etf1, etf2, etf3, etf4, tmp1, tmp2, tmp3, tmp4)

etf[seq(from = 1, to = 890, by = 2)] -> etf_ticker
etf[seq(from = 2, to = 890, by = 2)] -> etf_name

etf_list <- data.frame(name = etf_name, ticker = etf_ticker) %>% as_tibble %>% mutate_if(is.factor, as.character)


#### 19년 1월 1일 ~ 19년 11월 20일까지 데이터 ####
from = "20190101"
to   = "20191120"

url_base = "http://marketdata.krx.co.kr/contents/COM/GenerateOTP.jspx?name=fileDown&filetype=csv&url=MKD/13/1304/13040102/mkd13040102_01&trd_dd=20191121&acsString=1&domforn=00&uly_gubun=00&gubun=00&gubun2=2&pagePath=%2Fcontents%2FMKD%2F13%2F1304%2F13040102%2FMKD13040102.jsp&"
full_data <- NULL

for(tickers in etf_list$ticker){
  url = paste0(url_base, "isu_cd=", tickers, "&fromdate=", from, "&todate=", to)
  otp <- GET(url) %>% content("text")
  GET(url = "http://file.krx.co.kr/download.jspx",
      query = list(code = otp),
      add_headers(referer = "http://marketdata.krx.co.kr/contents/COM/GenerateOTP.jspx")
  ) %>%
    read_html %>%
    html_text %>%
    read_csv -> data
  data %>%
    mutate(
      상품명 = etf_list %>% filter(ticker == tickers) %>% select(name) %>% as.character,
      티커   = tickers
    ) -> data
  full_data <- rbind(full_data, data)
  cat("\n", tickers)
  Sys.sleep(3)
}

#### 18년 1월 1일 ~ 18년 12월 31일까지 데이터 ####
from = "20180101"
to   = "20181231"
read__csv <- function(x){try(assign("data", read_csv(x), envir = .GlobalEnv), silent = T)}

for(tickers in etf_list$ticker){
  url = paste0(url_base, "isu_cd=", tickers, "&fromdate=", from, "&todate=", to)
  otp <- GET(url) %>% content("text")
  GET(url = "http://file.krx.co.kr/download.jspx",
      query = list(code = otp),
      add_headers(referer = "http://marketdata.krx.co.kr/contents/COM/GenerateOTP.jspx")
  ) %>%
    read_html %>%
    html_text %>%
    read__csv
  if(dim(data) %>% is.null){
    cat("---")
  }else{
    data %>%
      mutate(
        상품명 = etf_list %>% filter(ticker == tickers) %>% select(name) %>% as.character,
        티커   = tickers
      ) -> data1
    full_data <- rbind(full_data, data1)
  }
  rm(data)
  cat("\n", tickers)
  Sys.sleep(1)
}

write.csv(full_data, "ETF 일자별 주가(18~19년도).csv")
